---js
{    
layout: "layouts/base.njk",
title: "Currently",
permalink: "/currently/listening.html",
}
---
<article class="w-full max-w-7xl mx-auto">
    <!-- Page meta section -->
    <section class="mb-16 text-center">
        <div class="flex items-center justify-center mb-6">
            <h1 class="font-serif text-4xl leading-tight font-medium md:text-5xl lg:text-6xl mb-6 text-left sm:text-center">Listening</h1>
        </div>
    </section>
    <!-- Page content -->
    <section class="flex justify-center">
        <!-- The 'prose' class from @tailwindcss/typography plugin will style the content [prose max-w-prose w-full] -->
        <div class="w-full">
            {# Annual Playlists Section #}
            <section id="annual-playlists">
                <div class="standard-text">
                    <h2 class="font-serif text-3xl font-medium mb-8 text-center">Annual playlists</h2>
                    <p class="text-muted-foreground mb-12 text-center">A collection of my yearly playlists, showcasing the music I've been enjoying each year.</p>
                    {# Placeholder for Annual Playlists Navigation/Filters #}
                    <nav class="flex flex-wrap justify-center gap-4 mb-12">
                        <a 
                            href="https://tidal.com/playlist/99ed7c04-f996-480f-a0fe-b1e128daa013" 
                            target="_blank" 
                            rel="noopener noreferrer" 
                            class="">
                        2025
                        </a> 
                        <a 
                            href="https://tidal.com/playlist/44c473cd-099f-4a58-9949-67c681ee9402" 
                            target="_blank" 
                            rel="noopener noreferrer" 
                            class="">
                        2024
                        </a> 
                    </nav>
                </div>
            </section>

            {# Live shows section fetched from local JSON version data #}
            <section id="gigs-attended"">
                <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                    <!-- Gig section header -->
                    <header class="text-center mb-8">
                        <h2 class="font-serif text-3xl font-medium mb-4 text-center mb-2">Concerts</h2>
                        <p class="text-muted-foreground mb-12 text-center">
                            A running list of gigs Iâ€™ve been lucky enough to see. Last updated on {{ setlists.attended.index.harvestedAt | date_format("D MMMM YYYY") }}.
                        </p>
                    </header>

                    {% set byYear = setlists.views.byYear %}
                    {% set index  = setlists.attended.index.items %}
                    {% if byYear and index %}
                        {# dictsort gives [key, value] pairs; reverse => newest year first #}
                        {% for pair in (byYear | dictsort) | reverse %}
                            {% set year = pair[0] %}
                            {% set ids  = pair[1] %}

                            <div class="mb-12">

                                <!-- Gigs by year header -->
                                <div class="flex items-center space-x-4 mb-4">
                                    <h3 class="text-2xl font-serif font-bold">{{ year }}</h3>
                                    <div class="flex-grow border-t border-huntergreen"></div>
                                </div>

                                {% for id in ids %}
                                    {# Prefer fast lookup if using views.byId; otherwise use findById filter #}
                                    {% set item = setlists.views.byId and setlists.views.byId[id] or (index | findById(id)) %}
                                    {% if item %}
                                        <!-- Gig card -->
                                        <article itemscope itemtype="http://schema.org/MusicEvent" class="bg-secondary p-6 rounded-lg shadow-md mb-4">
                                            <header>
                                                <h3 class="text-xl font-bold text-huntergreen mb-1">
                                                    <a itemprop="url" href="{{ item.url }}" target="_blank" rel="noopener noreferrer" class="link-artist">
                                                        <span itemprop="name">{{ item.artist }}</span>
                                                    </a>
                                                </h3>
                                                <p>
                                                    <span class="text-muted-foreground text-sm">
                                                        {% if item.eventDate %}<time itemprop="startDate" datetime="{{ item.eventDate | date_format("YYYY-MM-DD") }}">{{ item.eventDate | date_format("D MMMM YYYY") }}</time>{% endif %}
                                                        at
                                                        <span itemprop="location" itemscope itemtype="http://schema.org/Place">
                                                            <span itemprop="name">{% if item.venue %}{{ item.venue }}{% endif %}</span>
                                                            ,
                                                            <span itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">
                                                                <span itemprop="addressLocality">{% if item.city %}{{ item.city }}{% endif %}</span>
                                                                ,
                                                                <span itemprop="addressCountry">{% if item.country%}{{ item.country }}{% endif %}</span>
                                                            </span>
                                                        </span>
                                                    </span>
                                                </p>
                                            </header>

                                            <div class="mt-2 text-sm text-muted-foreground">
                                                <p itemprop="tour" itemscope itemtype="http://schema.org/Music">
                                                    Tour: <span itemprop="name">{% if item.tour %}{{ item.tour }}{% endif %}</span>
                                                </p>
                                                <p itemprop="superEvent" itemscope itemtype="http://schema.org/MusicEvent">
                                                    Festival: <span itemprop="name">{% if item.festival %}{{ item.festival }}{% endif %}</span>
                                                </p>
                                            </div>
                                        </article>

                                    {% endif %}
                                {% endfor %}
                                    
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted-foreground text-center">No attended shows found or there was an error retrieving Setlist.fm data.</p>
                    {% endif %}
                </div>
            </section>
        </div>
    </section>
</article>