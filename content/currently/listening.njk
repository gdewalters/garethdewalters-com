---js
{    
    layout: "layouts/base.njk",
    title: "Currently",
    permalink: "/currently/listening.html",
}
---

<article class="w-full max-w-7xl mx-auto">
    <!-- Page meta section -->
    <section class="mb-16 text-center">
        <div class="flex items-center justify-center mb-6">
            <h1 class="font-serif text-4xl leading-tight font-medium md:text-5xl lg:text-6xl mb-6 text-left sm:text-center">Listening</h1>
        </div>
    </section>

    <!-- Page content -->
    <section class="flex justify-center">
        <!-- The 'prose' class from @tailwindcss/typography plugin will style the content -->
        <div class="prose max-w-prose w-full">

            {# Annual Playlists Section #}
            <section class="">
                <div class="">
                    <h2 class="font-serif text-3xl font-medium mb-8 text-center">Annual playlists</h2>
                    <p class="text-muted-foreground mb-12 text-center">A collection of my yearly playlists, showcasing the music I've been enjoying each year.</p>
                    {# Placeholder for Annual Playlists Navigation/Filters #}
                    <nav class="flex flex-wrap justify-center gap-4 mb-12">
                        <a 
                            href="https://tidal.com/playlist/99ed7c04-f996-480f-a0fe-b1e128daa013" 
                            target="_blank" 
                            rel="noopener noreferrer" 
                            class="">
                        2025
                        </a> 

                        <a 
                            href="https://tidal.com/playlist/44c473cd-099f-4a58-9949-67c681ee9402" 
                            target="_blank" 
                            rel="noopener noreferrer" 
                            class="">
                        2024
                        </a> 
                    </nav>


                </div>


            </section>




            <section class="mt-16">

                {# _data/setlists.views.json -> setlists_views #}
                <h1>Live shows</h1>
                <p>Marked as attended on <a href="https://www.setlist.fm/">setlist.fm</a></p>

                {% set byYear = setlists_views and setlists_views.byYear %}
                {% set index = setlists_attended_index and setlists_attended_index.items %}

                {% if byYear and index %}
                {# dictsort returns [key, value] pairs; reverse to get newest year first #}
                {% for pair in (byYear | dictsort) | reverse %}
                    {% set year = pair[0] %}
                    {% set ids  = pair[1] %}

                    <h2>{{ year }}</h2>
                    <ul>
                    {% for id in ids %}
                        {% set item = index | findById(id) %}
                        {% if item %}
                        <li>
                            <strong>{{ item.artist }}</strong>
                            {% if item.tour %} for {{ item.tour }}{% endif %}<br/>
                            <small>{{ item.eventDate }} at {{ item.venue }}, {{ item.city }}{% if item.countryCode %}, {{ item.countryCode }}{% endif %}</small>
                            {% if item.festival %}<br/><em>{{ item.festival }}</em>{% endif %}
                        </li>
                        {% endif %}
                    {% endfor %}
                    </ul>
                {% endfor %}
                {% else %}
                <p class="text-muted-foreground">No local setlist data found.</p>
                {% endif %}

            </section>












            {# Live shows section (API fetch version) #}
            <section>
                <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h2 class="font-serif text-3xl font-medium mb-4 text-center">Live shows</h2>
                    <p class="text-muted-foreground mb-12 text-center">A running list of gigs Iâ€™ve been lucky enough to see.</p>

                    {% set gigsByYear = getSetlistFmAttended %}
                    {% if gigsByYear and (gigsByYear | length) > 0 %}
                    {% for year in gigsByYear | keys | sort(true) %}
                    <div class="mb-10">
                        <h3 class="font-serif text-2xl font-medium mb-4">{{ year }}</h3>
                        <ul class="space-y-6">
                            {% for gig in gigsByYear[year] %}
                            <li class="pb-6 border-b border-gray-200 last:border-b-0">
                                <p class="font-medium text-lg text-foreground">
                                    <span><a href="{{ gig.url }}" target="_blank" rel="noopener noreferrer">{{ gig.artist.name }}</a></span>
                                    
                                    {% if gig.tour and gig.tour.name %}
                                    <span class="text-muted-foreground">{{ gig.tour.name }}</span>
                                    {% endif %}
                                </p>
                                <p class="text-muted-foreground text-sm">{{ gig.eventDate }} at {{ gig.venue.name }}, {{ gig.venue.city.name }}{% if gig.venue.city.stateCode %}, {{ gig.venue.city.stateCode }}{% endif %}</p>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p class="text-muted-foreground text-center">No attended shows found or there was an error retrieving Setlist.fm data.</p>
                    {% endif %}
                </div>
            </section>



        </div>
    </section>
</article>