---js
{    
    layout: "layouts/base.njk",
    title: "Currently",
    permalink: "/currently/listening.html",
}
---

<article class="w-full max-w-7xl mx-auto">
    <!-- Page meta section -->
    <section class="mb-16 text-center">
        <div class="flex items-center justify-center mb-6">
            <h1 class="font-serif text-4xl leading-tight font-medium md:text-5xl lg:text-6xl mb-6 text-left sm:text-center">Listening</h1>
        </div>
    </section>

    <!-- Page content -->
    <section class="flex justify-center">
        <!-- The 'prose' class from @tailwindcss/typography plugin will style the content -->
        <div class="prose max-w-prose w-full">

            {# Annual Playlists Section #}
            <section class="">
                <div class="">
                    <h2 class="font-serif text-3xl font-medium mb-8 text-center">Annual playlists</h2>
                    <p class="text-muted-foreground mb-12 text-center">A collection of my yearly playlists, showcasing the music I've been enjoying each year.</p>
                    {# Placeholder for Annual Playlists Navigation/Filters #}
                    <nav class="flex flex-wrap justify-center gap-4 mb-12">
                        <a 
                            href="https://tidal.com/playlist/99ed7c04-f996-480f-a0fe-b1e128daa013" 
                            target="_blank" 
                            rel="noopener noreferrer" 
                            class="">
                        2025
                        </a> 

                        <a 
                            href="https://tidal.com/playlist/44c473cd-099f-4a58-9949-67c681ee9402" 
                            target="_blank" 
                            rel="noopener noreferrer" 
                            class="">
                        2024
                        </a> 
                    </nav>
                </div>
            </section>

            {# Live shows section fetched from local JSON version data #}
            <section>
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="font-serif text-3xl font-medium mb-4 text-center">Live shows</h2>
                <p class="text-muted-foreground mb-12 text-center">A running list of gigs Iâ€™ve been lucky enough to see. Last updated on {{ setlists.attended.index.harvestedAt | date_format("D MMMM YYYY") }}.</p>

                {% set byYear = setlists.views.byYear %}
                {% set index  = setlists.attended.index.items %}

                {% if byYear and index %}
                {# dictsort gives [key, value] pairs; reverse => newest year first #}
                {% for pair in (byYear | dictsort) | reverse %}
                    {% set year = pair[0] %}
                    {% set ids  = pair[1] %}

                    <div class="mb-10">
                    <h3 class="font-serif text-2xl font-medium mb-4">{{ year }}</h3>
                    <ul class="space-y-6">
                        {% for id in ids %}
                        {# Prefer fast lookup if you added views.byId; otherwise use findById filter #}
                        {% set item = setlists.views.byId and setlists.views.byId[id] or (index | findById(id)) %}
                        {% if item %}
                            <li class="pb-6 border-b border-gray-200 last:border-b-0">
                            <p class="font-medium text-lg text-foreground">
                                <span><a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.artist }}</a></span>
                                {% if item.tour %}
                                <span class="text-muted-foreground">{{ item.tour }}</span>
                                {% endif %}
                            </p>
                            <p class="text-muted-foreground text-sm">
                                {{ item.eventDate | date_format("D MMMM YYYY") }} at {{ item.venue }}
                                {% if item.city %}, {{ item.city }}{% endif %}
                                {% if item.countryCode %}, {{ item.countryCode }}{% endif %}
                            </p>
                            {% if item.festival %}
                                <p class="text-muted-foreground text-sm"><em>{{ item.festival }}</em></p>
                            {% endif %}
                            </li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    </div>
                {% endfor %}
                {% else %}
                <p class="text-muted-foreground text-center">No attended shows found or there was an error retrieving Setlist.fm data.</p>
                {% endif %}
            </div>
            </section>

        </div>
    </section>
</article>